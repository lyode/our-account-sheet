<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="My FinPlan">
    <meta name="theme-color" content="#1f2937">
    <title>My Financial Planning - Malaysia</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            width: 100%;
        }

        .mobile-app {
            width: 100%;
            height: 100vh;
            height: 100dvh;
            max-width: 430px;
            margin: 0 auto;
            background: #f8fafc;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.3);
        }

        .hidden { 
            display: none !important; 
        }

        .active-tab { 
            color: #1f2937 !important; 
            background-color: #f1f5f9 !important; 
            transform: scale(1.05);
        }

        /* Login Screen Styles */
        .login-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #1e40af 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 24px;
        }

        .login-container {
            width: 100%;
            max-width: 380px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 32px;
            padding: 40px 32px;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            color: white;
            box-shadow: 0 12px 32px rgba(59, 130, 246, 0.4);
        }

        .login-title {
            font-size: 28px;
            font-weight: 800;
            color: #1f2937;
            margin: 0 0 8px 0;
            letter-spacing: -0.5px;
        }

        .login-subtitle {
            font-size: 16px;
            color: #6b7280;
            margin: 0 0 32px 0;
            font-weight: 500;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: white;
            font-size: 32px;
            font-weight: 700;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }

        .user-info {
            margin-bottom: 32px;
        }

        .user-name {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 4px 0;
        }

        .user-email {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        }

        .login-methods {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .face-login-btn {
            padding: 20px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
        }

        .face-login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(59, 130, 246, 0.4);
        }

        .face-login-btn:active {
            transform: translateY(0);
        }

        .face-login-btn.scanning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .fallback-login {
            margin-top: 16px;
            display: flex;
            gap: 12px;
        }

        .pin-btn, .signup-btn {
            flex: 1;
            padding: 16px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #374151;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pin-btn:hover, .signup-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        /* Face Recognition Modal */
        .face-recognition-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1100;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        .face-scanner {
            width: 90%;
            max-width: 400px;
            background: #1f2937;
            border-radius: 24px;
            padding: 32px;
            text-align: center;
            color: white;
        }

        .scanner-header {
            margin-bottom: 24px;
        }

        .scanner-title {
            font-size: 20px;
            font-weight: 700;
            margin: 0 0 8px 0;
        }

        .scanner-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin: 0;
        }

        .camera-preview {
            width: 280px;
            height: 280px;
            border-radius: 20px;
            background: #374151;
            margin: 0 auto 24px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
        }

        .camera-placeholder {
            color: #9ca3af;
            font-size: 48px;
        }

        .face-overlay {
            position: absolute;
            inset: 20px;
            border: 3px solid #3b82f6;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.3s;
        }

        .face-overlay.active {
            opacity: 1;
            animation: scan-ring 2s infinite;
        }

        .face-overlay.success {
            border-color: #10b981;
            animation: success-pulse 0.5s;
        }

        .face-overlay.error {
            border-color: #ef4444;
            animation: error-shake 0.5s;
        }

        @keyframes scan-ring {
            0%, 100% { transform: scale(1); border-width: 3px; }
            50% { transform: scale(1.05); border-width: 5px; }
        }

        @keyframes success-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes error-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .scanner-status {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 24px;
            min-height: 24px;
        }

        .scanner-status.scanning {
            color: #f59e0b;
        }

        .scanner-status.success {
            color: #10b981;
        }

        .scanner-status.error {
            color: #ef4444;
        }

        .scanner-actions {
            display: flex;
            gap: 12px;
        }

        /* PIN Entry Modal */
        .pin-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1100;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .pin-container {
            width: 90%;
            max-width: 320px;
            background: white;
            border-radius: 24px;
            padding: 32px;
            text-align: center;
        }

        .pin-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 24px 0;
        }

        .pin-display {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .pin-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.2s;
        }

        .pin-dot.filled {
            background: #3b82f6;
            transform: scale(1.2);
        }

        .pin-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .pin-key {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #f3f4f6;
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 auto;
        }

        .pin-key:active {
            background: #3b82f6;
            color: white;
            transform: scale(0.95);
        }

        /* Registration Modal */
        .registration-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1100;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .registration-container {
            width: 90%;
            max-width: 400px;
            background: white;
            border-radius: 24px;
            padding: 32px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .registration-step {
            text-align: center;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s;
        }

        .step-dot.active {
            background: #3b82f6;
            transform: scale(1.5);
        }

        .step-dot.completed {
            background: #10b981;
        }

        .step-title {
            font-size: 22px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 8px 0;
        }

        .step-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin: 0 0 32px 0;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 500;
            background: white;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Face Enrollment Styles */
        .face-enrollment {
            text-align: center;
        }

        .enrollment-preview {
            width: 200px;
            height: 200px;
            border-radius: 20px;
            background: #f3f4f6;
            margin: 0 auto 24px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .enrollment-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
        }

        .enrollment-overlay {
            position: absolute;
            inset: 10px;
            border: 2px solid #3b82f6;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.3s;
        }

        .enrollment-overlay.scanning {
            opacity: 1;
            animation: enrollment-scan 1.5s infinite;
        }

        @keyframes enrollment-scan {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .enrollment-progress {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .enrollment-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            width: 0%;
            transition: width 0.3s;
        }

        .enrollment-instruction {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 24px;
        }

        /* Status Bar */
        .status-bar {
            background: #1f2937;
            color: white;
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .status-time {
            font-weight: 700;
        }

        .status-battery {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* App Header */
        .app-header {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 20px;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 800;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin: 0;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
            cursor: pointer;
        }

        .header-btn:active {
            transform: scale(0.95);
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Balance Display */
        .balance-display {
            text-align: center;
            padding: 16px 0;
        }

        .balance-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin: 0;
            font-weight: 500;
        }

        .balance-toggle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .balance-toggle:active {
            transform: scale(0.9);
        }

        .balance-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .balance-toggle.countdown {
            background: rgba(239, 68, 68, 0.3);
        }

        .countdown-ring {
            position: absolute;
            width: 36px;
            height: 36px;
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 50%;
            border-top: 2px solid #ef4444;
            animation: countdown-spin 1s linear infinite;
            display: none;
        }

        .countdown-ring.active {
            display: block;
        }

        @keyframes countdown-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 900;
            margin: 0;
            letter-spacing: -1px;
            transition: all 0.3s ease;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .balance-amount.hidden-amount {
            font-size: 32px;
            letter-spacing: 2px;
        }

        .balance-message {
            font-size: 12px;
            opacity: 0.8;
            margin: 8px 0 0 0;
        }

        .balance-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            border-radius: 16px;
            padding: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 6px;
        }

        .stat-icon {
            width: 16px;
            height: 16px;
            opacity: 0.9;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            font-weight: 500;
        }

        .stat-amount {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            transition: all 0.3s ease;
        }

        .stat-amount.hidden-amount {
            font-size: 16px;
            letter-spacing: 1px;
        }

        /* Auto-hide Timer Indicator */
        .timer-indicator {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            z-index: 60;
            opacity: 0;
            transition: opacity 0.3s;
            backdrop-filter: blur(10px);
        }

        .timer-indicator.show {
            opacity: 1;
        }

        /* Privacy Splash */
        .privacy-splash {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .privacy-splash.show {
            opacity: 1;
            visibility: visible;
        }

        .privacy-splash-content {
            background: white;
            padding: 32px;
            border-radius: 24px;
            text-align: center;
            max-width: 300px;
            margin: 0 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .privacy-icon {
            width: 64px;
            height: 64px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
        }

        .privacy-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 12px 0;
        }

        .privacy-text {
            font-size: 14px;
            color: #6b7280;
            margin: 0 0 24px 0;
            line-height: 1.5;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 100px;
            -webkit-overflow-scrolling: touch;
        }

        .main-content::-webkit-scrollbar {
            display: none;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .quick-action {
            background: white;
            border: none;
            border-radius: 20px;
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.2s;
            cursor: pointer;
        }

        .quick-action:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .action-icon {
            width: 28px;
            height: 28px;
            padding: 6px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-icon.income { background: #10b981; color: white; }
        .action-icon.expense { background: #ef4444; color: white; }
        .action-icon.payment { background: #3b82f6; color: white; }

        .action-text {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
            text-align: center;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .card-action {
            color: #6b7280;
            font-size: 14px;
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
        }

        /* Transaction Items */
        .transaction-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 16px;
            margin-bottom: 12px;
            position: relative;
            transition: all 0.2s;
        }

        .transaction-item:active {
            transform: scale(0.98);
        }

        .transaction-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .transaction-icon.income { background: #d1fae5; color: #10b981; }
        .transaction-icon.expense { background: #fee2e2; color: #ef4444; }

        .transaction-details {
            flex: 1;
            min-width: 0;
        }

        .transaction-title {
            font-size: 15px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 4px 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .transaction-meta {
            font-size: 12px;
            color: #6b7280;
            margin: 0;
        }

        .transaction-amount {
            text-align: right;
            flex-shrink: 0;
        }

        .amount-value {
            font-size: 16px;
            font-weight: 700;
            margin: 0 0 4px 0;
            transition: all 0.3s ease;
        }

        .amount-value.income { color: #10b981; }
        .amount-value.expense { color: #ef4444; }

        .amount-value.hidden-amount {
            font-size: 14px;
            letter-spacing: 1px;
            color: #9ca3af !important;
        }

        .amount-time {
            font-size: 11px;
            color: #9ca3af;
            margin: 0;
        }

        .transaction-actions {
            position: absolute;
            right: 12px;
            top: 12px;
            display: flex;
            gap: 4px;
            opacity: 0.7;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .action-btn.edit {
            background: #fef3c7;
            color: #f59e0b;
        }

        .action-btn.delete {
            background: #fee2e2;
            color: #ef4444;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: white;
            padding: 8px 20px 20px;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }

        .nav-tabs {
            display: flex;
            justify-content: space-around;
            gap: 8px;
        }

        .nav-tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            border-radius: 16px;
            border: none;
            background: none;
            color: #9ca3af;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-tab.active {
            color: #1f2937;
            background: #f1f5f9;
            transform: scale(1.05);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            display: flex;
            align-items: flex-end;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 430px;
            margin: 0 auto;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 24px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin: 4px 0 0 0;
        }

        .close-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f3f4f6;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-size: 18px;
            cursor: pointer;
        }

        /* Settings Modal */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 12px 0;
        }

        .settings-description {
            font-size: 14px;
            color: #6b7280;
            margin: 0 0 16px 0;
        }

        .timer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .timer-option {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            background: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timer-option.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .timer-value {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 4px 0;
        }

        .timer-label {
            font-size: 12px;
            color: #6b7280;
            margin: 0;
        }

        .amount-input-wrapper {
            position: relative;
        }

        .amount-prefix {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
        }

        .amount-input {
            padding-left: 50px;
            font-size: 18px;
            font-weight: 700;
        }

        /* Type Toggle */
        .type-toggle {
            display: flex;
            background: #f3f4f6;
            border-radius: 16px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .type-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }

        .type-btn.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .type-btn:not(.active) {
            background: none;
            color: #6b7280;
        }

        /* Buttons */
        .btn {
            padding: 16px 24px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #f3f4f6; color: #374151; }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: #f3f4f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 8px 0;
        }

        .empty-subtitle {
            font-size: 14px;
            margin: 0 0 20px 0;
        }

        /* Notification Toast */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            opacity: 0;
            transition: all 0.3s;
            max-width: calc(100% - 40px);
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.warning { background: #f59e0b; }

        /* Info Banner */
        .info-banner {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            color: #d97706;
            flex-shrink: 0;
        }

        .info-text {
            font-size: 13px;
            color: #92400e;
            font-weight: 500;
            flex: 1;
        }

        .info-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Health Indicator */
        .health-card {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #0ea5e9;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .health-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .health-title {
            font-size: 16px;
            font-weight: 700;
            color: #0c4a6e;
            margin: 0;
        }

        .health-ratio {
            font-size: 14px;
            font-weight: 600;
            color: #0369a1;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0f2fe;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: #0ea5e9;
            transition: width 0.3s;
        }

        .progress-label {
            font-size: 12px;
            color: #0369a1;
            margin: 0;
        }

        /* Privacy mode styles */
        .privacy-mode .amount-value,
        .privacy-mode .stat-amount,
        .privacy-mode .balance-amount {
            color: #9ca3af !important;
        }

        /* Responsive adjustments */
        @media (max-width: 375px) {
            .balance-amount { font-size: 32px; }
            .quick-action { padding: 16px 12px; }
            .main-content { padding: 16px; }
        }

        /* Safe area handling for iOS */
        @supports (padding: max(0px)) {
            .status-bar {
                padding-top: max(8px, env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body class="privacy-mode">
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="app-logo">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
            </div>
            
            <!-- Initial Login (No User) -->
            <div id="initial-login">
                <h1 class="login-title">My FinPlan</h1>
                <p class="login-subtitle">Secure Financial Planning for Malaysia</p>
                
                <div class="login-methods">
                    <button class="face-login-btn" onclick="showRegistration()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Get Started - Create Account
                    </button>
                    
                    <div class="fallback-login">
                        <button class="signup-btn" onclick="loadDemoUser()">Demo Account</button>
                    </div>
                </div>
            </div>
            
            <!-- User Login (Existing User) -->
            <div id="user-login" class="hidden">
                <div class="user-avatar" id="user-avatar">JD</div>
                <div class="user-info">
                    <h2 class="user-name" id="user-name">John Doe</h2>
                    <p class="user-email" id="user-email">john@example.com</p>
                </div>
                
                <div class="login-methods">
                    <button class="face-login-btn" id="face-login-btn" onclick="startFaceLogin()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 6v7.18l2 2V6h-2zM3.27 2L2 3.27 20.73 22 22 20.73 3.27 2zM14 12.27V12h3v-2h-5v2.27l2 2zM10 14v-4H8v4h2z"/>
                        </svg>
                        <span id="face-login-text">Login with Face ID</span>
                    </button>
                    
                    <div class="fallback-login">
                        <button class="pin-btn" onclick="showPinLogin()">PIN</button>
                        <button class="signup-btn" onclick="switchUser()">Switch User</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Face Recognition Modal -->
    <div id="face-recognition-modal" class="face-recognition-modal hidden">
        <div class="face-scanner">
            <div class="scanner-header">
                <h3 class="scanner-title" id="scanner-title">Face Recognition</h3>
                <p class="scanner-subtitle" id="scanner-subtitle">Position your face in the center</p>
            </div>
            
            <div class="camera-preview">
                <video id="camera-video" class="camera-video hidden" autoplay muted playsinline></video>
                <div id="camera-placeholder" class="camera-placeholder">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                        <circle cx="12" cy="13" r="4"/>
                    </svg>
                </div>
                <div id="face-overlay" class="face-overlay"></div>
            </div>
            
            <p class="scanner-status" id="scanner-status">Click "Start Scan" to begin</p>
            
            <div class="scanner-actions">
                <button class="btn btn-secondary" onclick="closeFaceRecognition()">Cancel</button>
                <button class="btn btn-primary" id="start-scan-btn" onclick="startCameraScan()">Start Scan</button>
            </div>
        </div>
    </div>

    <!-- PIN Entry Modal -->
    <div id="pin-modal" class="pin-modal hidden">
        <div class="pin-container">
            <h3 class="pin-title">Enter Your PIN</h3>
            
            <div class="pin-display">
                <div class="pin-dot" id="pin-dot-0"></div>
                <div class="pin-dot" id="pin-dot-1"></div>
                <div class="pin-dot" id="pin-dot-2"></div>
                <div class="pin-dot" id="pin-dot-3"></div>
                <div class="pin-dot" id="pin-dot-4"></div>
                <div class="pin-dot" id="pin-dot-5"></div>
            </div>
            
            <div class="pin-keypad">
                <button class="pin-key" onclick="enterPin('1')">1</button>
                <button class="pin-key" onclick="enterPin('2')">2</button>
                <button class="pin-key" onclick="enterPin('3')">3</button>
                <button class="pin-key" onclick="enterPin('4')">4</button>
                <button class="pin-key" onclick="enterPin('5')">5</button>
                <button class="pin-key" onclick="enterPin('6')">6</button>
                <button class="pin-key" onclick="enterPin('7')">7</button>
                <button class="pin-key" onclick="enterPin('8')">8</button>
                <button class="pin-key" onclick="enterPin('9')">9</button>
                <button class="pin-key" onclick="clearPin()" style="background: #fee2e2; color: #ef4444;">⌫</button>
                <button class="pin-key" onclick="enterPin('0')">0</button>
                <button class="pin-key" onclick="closePinLogin()" style="background: #f3f4f6; color: #6b7280;">✕</button>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registration-modal" class="registration-modal hidden">
        <div class="registration-container">
            <!-- Step 1: Personal Info -->
            <div id="registration-step-1" class="registration-step">
                <div class="step-indicator">
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h3 class="step-title">Create Account</h3>
                <p class="step-subtitle">Enter your personal information</p>
                
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="reg-name" class="form-input" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="reg-email" class="form-input" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" id="reg-phone" class="form-input" placeholder="Enter your phone number">
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="closeRegistration()">Cancel</button>
                    <button class="btn btn-primary" onclick="nextRegistrationStep(2)">Next</button>
                </div>
            </div>
            
            <!-- Step 2: Security PIN -->
            <div id="registration-step-2" class="registration-step hidden">
                <div class="step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h3 class="step-title">Security PIN</h3>
                <p class="step-subtitle">Create a 6-digit PIN for backup access</p>
                
                <div class="pin-display" style="margin-bottom: 32px;">
                    <div class="pin-dot" id="reg-pin-dot-0"></div>
                    <div class="pin-dot" id="reg-pin-dot-1"></div>
                    <div class="pin-dot" id="reg-pin-dot-2"></div>
                    <div class="pin-dot" id="reg-pin-dot-3"></div>
                    <div class="pin-dot" id="reg-pin-dot-4"></div>
                    <div class="pin-dot" id="reg-pin-dot-5"></div>
                </div>
                
                <div class="pin-keypad">
                    <button class="pin-key" onclick="enterRegPin('1')">1</button>
                    <button class="pin-key" onclick="enterRegPin('2')">2</button>
                    <button class="pin-key" onclick="enterRegPin('3')">3</button>
                    <button class="pin-key" onclick="enterRegPin('4')">4</button>
                    <button class="pin-key" onclick="enterRegPin('5')">5</button>
                    <button class="pin-key" onclick="enterRegPin('6')">6</button>
                    <button class="pin-key" onclick="enterRegPin('7')">7</button>
                    <button class="pin-key" onclick="enterRegPin('8')">8</button>
                    <button class="pin-key" onclick="enterRegPin('9')">9</button>
                    <button class="pin-key" onclick="clearRegPin()" style="background: #fee2e2; color: #ef4444;">⌫</button>
                    <button class="pin-key" onclick="enterRegPin('0')">0</button>
                    <button class="pin-key" style="opacity: 0; pointer-events: none;"></button>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="nextRegistrationStep(1)">Back</button>
                    <button class="btn btn-primary" id="pin-next-btn" onclick="nextRegistrationStep(3)" disabled>Next</button>
                </div>
            </div>
            
            <!-- Step 3: Face Enrollment -->
            <div id="registration-step-3" class="registration-step hidden">
                <div class="step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                </div>
                
                <h3 class="step-title">Face ID Setup</h3>
                <p class="step-subtitle">Secure your account with face recognition</p>
                
                <div class="face-enrollment">
                    <div class="enrollment-preview">
                        <video id="enrollment-video" class="enrollment-video hidden" autoplay muted playsinline></video>
                        <div id="enrollment-placeholder" class="camera-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                <circle cx="12" cy="13" r="4"/>
                            </svg>
                        </div>
                        <div id="enrollment-overlay" class="enrollment-overlay"></div>
                    </div>
                    
                    <div class="enrollment-progress">
                        <div id="enrollment-progress-fill" class="enrollment-progress-fill"></div>
                    </div>
                    
                    <p class="enrollment-instruction" id="enrollment-instruction">
                        Position your face in the center and click "Start Enrollment"
                    </p>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="nextRegistrationStep(2)">Back</button>
                    <button class="btn btn-primary" id="enrollment-btn" onclick="startFaceEnrollment()">Start Enrollment</button>
                </div>
            </div>
            
            <!-- Step 4: Completion -->
            <div id="registration-step-4" class="registration-step hidden">
                <div class="step-indicator">
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot completed"></div>
                    <div class="step-dot active"></div>
                </div>
                
                <h3 class="step-title">Account Created!</h3>
                <p class="step-subtitle">Your secure financial account is ready</p>
                
                <div style="text-align: center; margin: 32px 0;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; color: white;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20,6 9,17 4,12"/>
                        </svg>
                    </div>
                    <p style="font-size: 16px; color: #6b7280; margin: 0;">
                        You can now login with Face ID or your PIN
                    </p>
                </div>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="completeRegistration()">
                    Start Using My FinPlan
                </button>
            </div>
        </div>
    </div>

    <!-- Privacy Splash -->
    <div id="privacy-splash" class="privacy-splash">
        <div class="privacy-splash-content">
            <div class="privacy-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <circle cx="12" cy="16" r="1"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
            </div>
            <h3 class="privacy-title">Privacy Protected</h3>
            <p class="privacy-text">Your financial data is hidden for privacy. Tap the eye icon to reveal amounts temporarily.</p>
            <button class="btn btn-primary" onclick="hidePrivacySplash()">Got it!</button>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification"></div>

    <!-- Auto-hide Timer Indicator -->
    <div id="timer-indicator" class="timer-indicator">
        <span id="timer-text">Auto-hide in 10s</span>
    </div>

    <div class="mobile-app">
        <!-- Status Bar -->
        <div class="status-bar">
            <span class="status-time" id="current-time">9:41</span>
            <span style="font-weight: 500;">My FinPlan</span>
            <div class="status-battery">
                <span>100%</span>
                <svg width="24" height="12" viewBox="0 0 24 12" fill="currentColor">
                    <rect x="0" y="2" width="20" height="8" rx="2" fill="currentColor"/>
                    <rect x="21" y="4" width="2" height="4" rx="1" fill="currentColor"/>
                </svg>
            </div>
        </div>

        <!-- App Header -->
        <div class="app-header">
            <div class="header-top">
                <div>
                    <h1 class="header-title">My Financial Planning</h1>
                    <p class="header-subtitle" id="header-user">Welcome back, <span id="header-username">User</span></p>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="openSettings()" title="Privacy Settings">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </button>
                    <button class="header-btn" onclick="logout()" title="Logout">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="balance-display">
                <div class="balance-header">
                    <p class="balance-label">Current Balance</p>
                    <button class="balance-toggle" onclick="toggleBalanceVisibility()" title="Show/Hide Balance">
                        <div id="countdown-ring" class="countdown-ring"></div>
                        <svg id="visibility-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                            <line x1="1" y1="1" x2="23" y2="23"/>
                        </svg>
                    </button>
                </div>
                <h2 class="balance-amount hidden-amount" id="balance-display">••••••••</h2>
                <p class="balance-message" id="balance-message">Tap the eye to view your balance</p>
            </div>

            <div class="balance-stats">
                <div class="stat-card">
                    <div class="stat-header">
                        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span class="stat-label">Income</span>
                    </div>
                    <p class="stat-amount hidden-amount" id="income-display">••••••</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span class="stat-label">Expenses</span>
                    </div>
                    <p class="stat-amount hidden-amount" id="expenses-display">••••••</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Home Tab -->
            <div id="home-tab">
                <!-- Info Banner -->
                <div class="info-banner">
                    <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <circle cx="12" cy="16" r="1"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    <div class="info-text">
                        <strong>Secure & Private:</strong> Face ID login with privacy protection. Amounts auto-hide for security.
                    </div>
                    <button class="info-btn" onclick="loadDemoData()">Demo</button>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action" onclick="openAddForm('income')">
                        <div class="action-icon income">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                        </div>
                        <span class="action-text">Add Income</span>
                    </button>
                    <button class="quick-action" onclick="openAddForm('expense')">
                        <div class="action-icon expense">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                        </div>
                        <span class="action-text">Add Expense</span>
                    </button>
                    <button class="quick-action" onclick="openPaymentForm()">
                        <div class="action-icon payment">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                        </div>
                        <span class="action-text">Payment</span>
                    </button>
                </div>

                <!-- Health Card -->
                <div class="health-card">
                    <div class="health-header">
                        <h3 class="health-title">Financial Health</h3>
                        <span class="health-ratio" id="expense-ratio">N/A</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="expense-progress"></div>
                    </div>
                    <p class="progress-label">Keep expenses below 80% of income</p>
                </div>

                <!-- Recent Transactions -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                        <button class="card-action" onclick="showTab('transactions')">View All</button>
                    </div>
                    <div id="recent-transactions">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                            </div>
                            <h4 class="empty-title">Welcome to Malaysian Planning!</h4>
                            <p class="empty-subtitle">Secure financial tracking with Face ID protection</p>
                            <div style="display: flex; gap: 12px; justify-content: center;">
                                <button class="btn btn-primary" onclick="openAddForm('expense')">Add Transaction</button>
                                <button class="btn btn-secondary" onclick="loadDemoData()">Demo Data</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Demo Actions -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <button class="btn" style="background: #f59e0b; color: white;" onclick="loadDemoData()">
                        🎯 Load Demo Data
                    </button>
                    <button class="btn" style="background: #ef4444; color: white;" onclick="clearAllData()">
                        🗑️ Clear All Data
                    </button>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions-tab" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Transactions</h3>
                        <span class="card-action" id="transaction-count">0 entries</span>
                    </div>
                    <div id="all-transactions">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"/>
                                    <line x1="8" y1="12" x2="21" y2="12"/>
                                    <line x1="8" y1="18" x2="21" y2="18"/>
                                    <line x1="3" y1="6" x2="3.01" y2="6"/>
                                    <line x1="3" y1="12" x2="3.01" y2="12"/>
                                    <line x1="3" y1="18" x2="3.01" y2="18"/>
                                </svg>
                            </div>
                            <h4 class="empty-title">No transactions saved yet</h4>
                            <p class="empty-subtitle">Add transactions or load demo data to see them here</p>
                            <button class="btn btn-primary" onclick="loadDemoData()">Load Demo Data</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics-tab" class="hidden">
                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <div class="card" style="text-align: center; margin-bottom: 0;">
                        <h4 style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">Income Entries</h4>
                        <p id="income-count" style="margin: 0; font-size: 24px; font-weight: 700; color: #10b981;">0</p>
                    </div>
                    <div class="card" style="text-align: center; margin-bottom: 0;">
                        <h4 style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">Expense Entries</h4>
                        <p id="expense-count" style="margin: 0; font-size: 24px; font-weight: 700; color: #ef4444;">0</p>
                    </div>
                </div>

                <!-- Financial Summary -->
                <div class="card">
                    <h3 class="card-title">Financial Summary</h3>
                    <div style="display: flex; flex-direction: column; gap: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #6b7280; font-weight: 500;">Total Income</span>
                            <span id="analytics-income" style="color: #10b981; font-weight: 700; font-size: 16px;">••••••</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #6b7280; font-weight: 500;">Total Expenses</span>
                            <span id="analytics-expenses" style="color: #ef4444; font-weight: 700; font-size: 16px;">••••••</span>
                        </div>
                        <div style="border-top: 1px solid #f3f4f6; padding-top: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #1f2937; font-weight: 600;">Net Balance</span>
                                <span id="analytics-balance" style="font-weight: 700; font-size: 20px; color: #1f2937;">••••••••</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health Score -->
                <div class="card">
                    <h3 class="card-title">Financial Health Score</h3>
                    <div style="text-align: center;">
                        <div id="health-score" style="font-size: 48px; font-weight: 900; margin-bottom: 8px; color: #6b7280;">-</div>
                        <p id="health-message" style="font-size: 14px; color: #6b7280; margin: 0;">Add income to calculate health score</p>
                    </div>
                </div>

                <!-- Category Analytics -->
                <div id="category-analytics" class="card hidden">
                    <h3 class="card-title">Spending by Category</h3>
                    <div id="category-list"></div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('home')" data-tab="home">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    <span>Home</span>
                </button>
                <button class="nav-tab" onclick="showTab('transactions')" data-tab="transactions">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"/>
                        <line x1="8" y1="12" x2="21" y2="12"/>
                        <line x1="8" y1="18" x2="21" y2="18"/>
                        <line x1="3" y1="6" x2="3.01" y2="6"/>
                        <line x1="3" y1="12" x2="3.01" y2="12"/>
                        <line x1="3" y1="18" x2="3.01" y2="18"/>
                    </svg>
                    <span>History</span>
                </button>
                <button class="nav-tab" onclick="showTab('analytics')" data-tab="analytics">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="20" x2="12" y2="10"/>
                        <line x1="18" y1="20" x2="18" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="16"/>
                    </svg>
                    <span>Analytics</span>
                </button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h2 class="modal-title">Privacy & Security</h2>
                        <p class="modal-subtitle">Configure privacy and security settings</p>
                    </div>
                    <button class="close-btn" onclick="closeSettings()">✕</button>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title">Security Options</h3>
                    <p class="settings-description">Manage your login and security preferences.</p>
                    
                    <div style="background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22,4 12,14.01 9,11.01"/>
                            </svg>
                            <span style="font-weight: 600; color: #1f2937;">Face ID Enabled</span>
                        </div>
                        <p style="margin: 0; font-size: 13px; color: #6b7280;">Secure biometric authentication active</p>
                    </div>
                    
                    <div style="background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22,4 12,14.01 9,11.01"/>
                            </svg>
                            <span style="font-weight: 600; color: #1f2937;">PIN Backup Available</span>
                        </div>
                        <p style="margin: 0; font-size: 13px; color: #6b7280;">6-digit PIN for alternative access</p>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title">Auto-Hide Timer</h3>
                    <p class="settings-description">Choose how long amounts stay visible before automatically hiding for privacy.</p>
                    
                    <div class="timer-options">
                        <div class="timer-option" onclick="selectTimer(10)" data-timer="10">
                            <p class="timer-value">10s</p>
                            <p class="timer-label">Quick</p>
                        </div>
                        <div class="timer-option" onclick="selectTimer(15)" data-timer="15">
                            <p class="timer-value">15s</p>
                            <p class="timer-label">Fast</p>
                        </div>
                        <div class="timer-option active" onclick="selectTimer(30)" data-timer="30">
                            <p class="timer-value">30s</p>
                            <p class="timer-label">Default</p>
                        </div>
                        <div class="timer-option" onclick="selectTimer(60)" data-timer="60">
                            <p class="timer-value">1min</p>
                            <p class="timer-label">Medium</p>
                        </div>
                        <div class="timer-option" onclick="selectTimer(120)" data-timer="120">
                            <p class="timer-value">2min</p>
                            <p class="timer-label">Long</p>
                        </div>
                        <div class="timer-option" onclick="selectTimer(0)" data-timer="0">
                            <p class="timer-value">Never</p>
                            <p class="timer-label">Manual</p>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Transaction Modal -->
        <div id="add-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h2 class="modal-title" id="modal-title">Add Transaction</h2>
                        <p class="modal-subtitle">Malaysian Ringgit (RM) Format</p>
                    </div>
                    <button class="close-btn" onclick="closeModal()">✕</button>
                </div>

                <!-- Type Toggle -->
                <div id="type-toggle" class="type-toggle">
                    <button class="type-btn active" id="expense-btn" onclick="setType('expense')">Expense</button>
                    <button class="type-btn" id="income-btn" onclick="setType('income')">Income</button>
                </div>

                <!-- Amount -->
                <div class="form-group">
                    <label class="form-label">Amount (RM)</label>
                    <div class="amount-input-wrapper">
                        <span class="amount-prefix">RM</span>
                        <input type="number" id="amount-input" placeholder="0.00" step="0.01" class="form-input amount-input">
                    </div>
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" id="description-input" placeholder="Enter description" class="form-input">
                </div>

                <!-- Category -->
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="category-input" class="form-input">
                        <option value="">Select category</option>
                        <option value="Food & Dining">Food & Dining</option>
                        <option value="Transportation">Transportation</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Bills & Utilities">Bills & Utilities</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Education">Education</option>
                        <option value="Travel">Travel</option>
                        <option value="Salary">Salary</option>
                        <option value="Business">Business</option>
                        <option value="Investment">Investment</option>
                        <option value="Gift">Gift</option>
                        <option value="Savings">Savings</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <!-- Payment Method -->
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <select id="payment-input" class="form-input">
                        <option value="">Select payment method</option>
                        <option value="Cash">Cash</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Debit Card">Debit Card</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Touch 'n Go eWallet">Touch 'n Go eWallet</option>
                        <option value="Grab Pay">Grab Pay</option>
                        <option value="Boost">Boost</option>
                        <option value="Online Banking">Online Banking</option>
                        <option value="FPX">FPX</option>
                        <option value="Check">Check</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-danger" id="submit-btn" onclick="addTransaction()">Add Expense</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state with localStorage persistence
        let transactions = [];
        let currentType = 'expense';
        let isPaymentMode = false;
        let isEditMode = false;
        let editingTransactionId = null;
        let balanceVisible = false; // Always start hidden
        let autoHideTimer = null;
        let autoHideSeconds = 30; // Default 30 seconds
        let countdownInterval = null;
        let remainingSeconds = 0;
        let firstVisit = true;
        
        // User authentication state
        let currentUser = null;
        let isLoggedIn = false;
        let cameraStream = null;
        
        // Registration state
        let registrationStep = 1;
        let registrationData = {};
        let registrationPin = '';
        let currentPin = '';
        let faceEnrollmentProgress = 0;

        // LocalStorage keys
        const STORAGE_KEY = 'malaysiaPlanningTransactions';
        const PRIVACY_KEY = 'malaysiaPlanningPrivacy';
        const TIMER_KEY = 'malaysiaPlanningTimer';
        const FIRST_VISIT_KEY = 'malaysiaPlanningFirstVisit';
        const USER_KEY = 'malaysiaPlanningUser';
        const USERS_KEY = 'malaysiaPlanningUsers';

        // Demo user data
        const demoUser = {
            id: 'demo_user_001',
            name: 'Demo User',
            email: 'demo@finplan.my',
            phone: '+60123456789',
            pin: '123456',
            faceId: 'demo_face_template',
            avatar: 'DU',
            createdAt: new Date().toISOString()
        };

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('current-time').textContent = timeString;
        }

        // Currency formatting function with commas
        function formatCurrency(amount) {
            return `RM ${amount.toLocaleString('en-MY', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })}`;
        }

        // Format currency for privacy mode
        function formatCurrencyWithPrivacy(amount) {
            if (!balanceVisible) {
                const amountStr = amount.toString();
                const digitCount = amountStr.replace(/[^\d]/g, '').length;
                return '••••••••'.substring(0, Math.max(4, Math.min(8, digitCount)));
            }
            return formatCurrency(amount);
        }

        // Parse number input (remove commas and convert to float)
        function parseAmount(value) {
            return parseFloat(value.toString().replace(/,/g, ''));
        }

        // User Authentication Functions
        function loadUsers() {
            try {
                const saved = localStorage.getItem(USERS_KEY);
                return saved ? JSON.parse(saved) : [];
            } catch (e) {
                console.error('Error loading users:', e);
                return [];
            }
        }

        function saveUsers(users) {
            try {
                localStorage.setItem(USERS_KEY, JSON.stringify(users));
            } catch (e) {
                console.error('Error saving users:', e);
            }
        }

        function loadCurrentUser() {
            try {
                const saved = localStorage.getItem(USER_KEY);
                if (saved) {
                    currentUser = JSON.parse(saved);
                    isLoggedIn = true;
                    return true;
                }
            } catch (e) {
                console.error('Error loading current user:', e);
            }
            return false;
        }

        function saveCurrentUser() {
            try {
                localStorage.setItem(USER_KEY, JSON.stringify(currentUser));
            } catch (e) {
                console.error('Error saving current user:', e);
            }
        }

        function checkLoginStatus() {
            const hasUser = loadCurrentUser();
            if (hasUser) {
                showUserLogin();
            } else {
                showInitialLogin();
            }
            return hasUser;
        }

        function showInitialLogin() {
            document.getElementById('initial-login').classList.remove('hidden');
            document.getElementById('user-login').classList.add('hidden');
        }

        function showUserLogin() {
            document.getElementById('initial-login').classList.add('hidden');
            document.getElementById('user-login').classList.remove('hidden');
            
            // Update user display
            document.getElementById('user-avatar').textContent = currentUser.avatar;
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-email').textContent = currentUser.email;
        }

        function loadDemoUser() {
            // Save demo user
            const users = loadUsers();
            if (!users.find(u => u.id === demoUser.id)) {
                users.push(demoUser);
                saveUsers(users);
            }
            
            currentUser = demoUser;
            saveCurrentUser();
            loginSuccess();
        }

        function loginSuccess() {
            isLoggedIn = true;
            document.getElementById('login-screen').classList.add('hidden');
            
            // Update header with user info
            document.getElementById('header-username').textContent = currentUser.name.split(' ')[0];
            
            // Load user's transactions
            loadTransactions();
            updateDisplays();
            
            showNotification(`👋 Welcome back, ${currentUser.name.split(' ')[0]}!`, 'success');
            
            // Show privacy splash for first-time users
            setTimeout(() => {
                if (firstVisit) {
                    showPrivacySplash();
                }
            }, 1000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                isLoggedIn = false;
                currentUser = null;
                
                // Clear current user but keep registration data
                localStorage.removeItem(USER_KEY);
                
                // Stop any active camera streams
                if (cameraStream) {
                    cameraStream.getTracks().forEach(track => track.stop());
                    cameraStream = null;
                }
                
                // Show login screen
                document.getElementById('login-screen').classList.remove('hidden');
                checkLoginStatus();
                
                showNotification('🔒 Logged out successfully', 'warning');
            }
        }

        function switchUser() {
            logout();
        }

        // Face Recognition Functions
        function startFaceLogin() {
            document.getElementById('face-recognition-modal').classList.remove('hidden');
            document.getElementById('scanner-title').textContent = 'Face Recognition Login';
            document.getElementById('scanner-subtitle').textContent = 'Position your face in the center';
            document.getElementById('scanner-status').textContent = 'Click "Start Scan" to begin';
            document.getElementById('start-scan-btn').textContent = 'Start Scan';
        }

        function closeFaceRecognition() {
            document.getElementById('face-recognition-modal').classList.add('hidden');
            stopCamera();
        }

        async function startCameraScan() {
            try {
                document.getElementById('scanner-status').textContent = 'Requesting camera access...';
                document.getElementById('scanner-status').className = 'scanner-status';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    } 
                });
                
                cameraStream = stream;
                const video = document.getElementById('camera-video');
                video.srcObject = stream;
                
                document.getElementById('camera-placeholder').classList.add('hidden');
                video.classList.remove('hidden');
                
                document.getElementById('start-scan-btn').textContent = 'Scanning...';
                document.getElementById('start-scan-btn').disabled = true;
                
                // Start face detection simulation
                setTimeout(() => {
                    simulateFaceDetection();
                }, 1000);
                
            } catch (error) {
                console.error('Camera access error:', error);
                document.getElementById('scanner-status').textContent = 'Camera access denied. Please enable camera permissions.';
                document.getElementById('scanner-status').className = 'scanner-status error';
            }
        }

        function simulateFaceDetection() {
            const overlay = document.getElementById('face-overlay');
            const status = document.getElementById('scanner-status');
            
            overlay.classList.add('active');
            status.textContent = 'Face detected. Analyzing...';
            status.className = 'scanner-status scanning';
            
            // Simulate face recognition process
            setTimeout(() => {
                overlay.classList.remove('active');
                overlay.classList.add('success');
                status.textContent = 'Face recognition successful!';
                status.className = 'scanner-status success';
                
                setTimeout(() => {
                    closeFaceRecognition();
                    loginSuccess();
                }, 1500);
            }, 3000);
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            
            const video = document.getElementById('camera-video');
            video.classList.add('hidden');
            document.getElementById('camera-placeholder').classList.remove('hidden');
            document.getElementById('face-overlay').className = 'face-overlay';
            document.getElementById('start-scan-btn').disabled = false;
        }

        // PIN Functions
        function showPinLogin() {
            document.getElementById('pin-modal').classList.remove('hidden');
            currentPin = '';
            updatePinDisplay();
        }

        function closePinLogin() {
            document.getElementById('pin-modal').classList.add('hidden');
            currentPin = '';
            updatePinDisplay();
        }

        function enterPin(digit) {
            if (currentPin.length < 6) {
                currentPin += digit;
                updatePinDisplay();
                
                if (currentPin.length === 6) {
                    verifyPin();
                }
            }
        }

        function clearPin() {
            if (currentPin.length > 0) {
                currentPin = currentPin.slice(0, -1);
                updatePinDisplay();
            }
        }

        function updatePinDisplay() {
            for (let i = 0; i < 6; i++) {
                const dot = document.getElementById(`pin-dot-${i}`);
                if (i < currentPin.length) {
                    dot.classList.add('filled');
                } else {
                    dot.classList.remove('filled');
                }
            }
        }

        function verifyPin() {
            if (currentPin === currentUser.pin) {
                showNotification('✅ PIN verified successfully!', 'success');
                closePinLogin();
                loginSuccess();
            } else {
                showNotification('❌ Incorrect PIN. Please try again.', 'error');
                currentPin = '';
                updatePinDisplay();
            }
        }

        // Registration Functions
        function showRegistration() {
            document.getElementById('registration-modal').classList.remove('hidden');
            registrationStep = 1;
            registrationData = {};
            registrationPin = '';
            showRegistrationStep(1);
        }

        function closeRegistration() {
            document.getElementById('registration-modal').classList.add('hidden');
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
        }

        function nextRegistrationStep(step) {
            if (step === 2) {
                // Validate step 1
                const name = document.getElementById('reg-name').value.trim();
                const email = document.getElementById('reg-email').value.trim();
                const phone = document.getElementById('reg-phone').value.trim();
                
                if (!name || !email || !phone) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                registrationData = { name, email, phone };
            }
            
            if (step === 3 && registrationPin.length !== 6) {
                showNotification('Please set a 6-digit PIN', 'error');
                return;
            }
            
            registrationStep = step;
            showRegistrationStep(step);
        }

        function showRegistrationStep(step) {
            // Hide all steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`registration-step-${i}`).classList.add('hidden');
            }
            
            // Show current step
            document.getElementById(`registration-step-${step}`).classList.remove('hidden');
        }

        function enterRegPin(digit) {
            if (registrationPin.length < 6) {
                registrationPin += digit;
                updateRegPinDisplay();
                
                const nextBtn = document.getElementById('pin-next-btn');
                if (registrationPin.length === 6) {
                    nextBtn.disabled = false;
                    nextBtn.classList.remove('btn-secondary');
                    nextBtn.classList.add('btn-primary');
                } else {
                    nextBtn.disabled = true;
                    nextBtn.classList.add('btn-secondary');
                    nextBtn.classList.remove('btn-primary');
                }
            }
        }

        function clearRegPin() {
            if (registrationPin.length > 0) {
                registrationPin = registrationPin.slice(0, -1);
                updateRegPinDisplay();
                
                const nextBtn = document.getElementById('pin-next-btn');
                if (registrationPin.length < 6) {
                    nextBtn.disabled = true;
                    nextBtn.classList.add('btn-secondary');
                    nextBtn.classList.remove('btn-primary');
                }
            }
        }

        function updateRegPinDisplay() {
            for (let i = 0; i < 6; i++) {
                const dot = document.getElementById(`reg-pin-dot-${i}`);
                if (i < registrationPin.length) {
                    dot.classList.add('filled');
                } else {
                    dot.classList.remove('filled');
                }
            }
        }

        // Face Enrollment Functions
        async function startFaceEnrollment() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 320 },
                        height: { ideal: 320 }
                    } 
                });
                
                cameraStream = stream;
                const video = document.getElementById('enrollment-video');
                video.srcObject = stream;
                
                document.getElementById('enrollment-placeholder').classList.add('hidden');
                video.classList.remove('hidden');
                
                document.getElementById('enrollment-btn').textContent = 'Enrolling...';
                document.getElementById('enrollment-btn').disabled = true;
                
                // Start enrollment simulation
                simulateFaceEnrollment();
                
            } catch (error) {
                console.error('Camera access error:', error);
                document.getElementById('enrollment-instruction').textContent = 'Camera access denied. Please enable camera permissions.';
            }
        }

        function simulateFaceEnrollment() {
            const overlay = document.getElementById('enrollment-overlay');
            const progressFill = document.getElementById('enrollment-progress-fill');
            const instruction = document.getElementById('enrollment-instruction');
            
            overlay.classList.add('scanning');
            instruction.textContent = 'Keep your face centered. Analyzing features...';
            
            // Simulate enrollment progress
            faceEnrollmentProgress = 0;
            const enrollmentInterval = setInterval(() => {
                faceEnrollmentProgress += 20;
                progressFill.style.width = `${faceEnrollmentProgress}%`;
                
                if (faceEnrollmentProgress >= 100) {
                    clearInterval(enrollmentInterval);
                    overlay.classList.remove('scanning');
                    instruction.textContent = 'Face enrollment completed successfully!';
                    
                    setTimeout(() => {
                        nextRegistrationStep(4);
                    }, 1500);
                }
            }, 800);
        }

        function completeRegistration() {
            // Create user account
            const newUser = {
                id: `user_${Date.now()}`,
                name: registrationData.name,
                email: registrationData.email,
                phone: registrationData.phone,
                pin: registrationPin,
                faceId: `face_template_${Date.now()}`,
                avatar: registrationData.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2),
                createdAt: new Date().toISOString()
            };
            
            // Save to users list
            const users = loadUsers();
            users.push(newUser);
            saveUsers(users);
            
            // Set as current user
            currentUser = newUser;
            saveCurrentUser();
            
            // Close registration
            closeRegistration();
            
            // Login success
            loginSuccess();
            
            showNotification('🎉 Account created successfully!', 'success');
        }

        // Privacy and Timer Functions (same as before)
        function startAutoHideTimer() {
            if (autoHideSeconds === 0) return;
            
            clearAutoHideTimer();
            remainingSeconds = autoHideSeconds;
            
            if (autoHideSeconds <= 10) {
                showTimerIndicator();
                startCountdown();
            } else {
                autoHideTimer = setTimeout(() => {
                    showTimerIndicator();
                    startCountdown();
                }, (autoHideSeconds - 10) * 1000);
            }
        }

        function startCountdown() {
            const startSeconds = Math.min(remainingSeconds, 10);
            remainingSeconds = startSeconds;
            
            updateTimerDisplay();
            
            countdownInterval = setInterval(() => {
                remainingSeconds--;
                updateTimerDisplay();
                
                if (remainingSeconds <= 0) {
                    clearInterval(countdownInterval);
                    hideTimerIndicator();
                    autoHideBalance();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerText = document.getElementById('timer-text');
            const countdownRing = document.getElementById('countdown-ring');
            
            if (remainingSeconds > 0) {
                timerText.textContent = `Auto-hide in ${remainingSeconds}s`;
                countdownRing.classList.add('active');
                document.querySelector('.balance-toggle').classList.add('countdown');
            }
        }

        function showTimerIndicator() {
            document.getElementById('timer-indicator').classList.add('show');
        }

        function hideTimerIndicator() {
            document.getElementById('timer-indicator').classList.remove('show');
            document.getElementById('countdown-ring').classList.remove('active');
            document.querySelector('.balance-toggle').classList.remove('countdown');
        }

        function clearAutoHideTimer() {
            if (autoHideTimer) {
                clearTimeout(autoHideTimer);
                autoHideTimer = null;
            }
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            hideTimerIndicator();
        }

        function autoHideBalance() {
            if (balanceVisible) {
                balanceVisible = false;
                updateVisibilityIcon();
                updateDisplays();
                document.body.classList.add('privacy-mode');
                showNotification('🔒 Amounts auto-hidden for privacy', 'warning');
            }
        }

        function toggleBalanceVisibility() {
            balanceVisible = !balanceVisible;
            
            clearAutoHideTimer();
            localStorage.setItem(PRIVACY_KEY, JSON.stringify(balanceVisible));
            updateVisibilityIcon();
            updateDisplays();
            
            showNotification(
                balanceVisible ? '👁️ Amounts visible' : '🫣 Amounts hidden', 
                'success'
            );
            
            if (balanceVisible) {
                document.body.classList.remove('privacy-mode');
                startAutoHideTimer();
            } else {
                document.body.classList.add('privacy-mode');
            }
        }

        function updateVisibilityIcon() {
            const icon = document.getElementById('visibility-icon');
            if (balanceVisible) {
                icon.innerHTML = `
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                `;
            } else {
                icon.innerHTML = `
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                    <line x1="1" y1="1" x2="23" y2="23"/>
                `;
            }
        }

        function loadPrivacyPreference() {
            try {
                const savedTimer = localStorage.getItem(TIMER_KEY);
                const savedFirstVisit = localStorage.getItem(FIRST_VISIT_KEY);
                
                balanceVisible = false;
                firstVisit = savedFirstVisit === null;
                
                if (savedTimer !== null) {
                    autoHideSeconds = parseInt(savedTimer);
                }
            } catch (e) {
                balanceVisible = false;
                autoHideSeconds = 30;
                firstVisit = true;
            }
            
            updateVisibilityIcon();
            document.body.classList.add('privacy-mode');
        }

        function showPrivacySplash() {
            if (firstVisit) {
                document.getElementById('privacy-splash').classList.add('show');
            }
        }

        function hidePrivacySplash() {
            document.getElementById('privacy-splash').classList.remove('show');
            localStorage.setItem(FIRST_VISIT_KEY, 'false');
            firstVisit = false;
        }

        function openSettings() {
            document.querySelectorAll('.timer-option').forEach(option => {
                option.classList.remove('active');
                if (parseInt(option.dataset.timer) === autoHideSeconds) {
                    option.classList.add('active');
                }
            });
            
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function selectTimer(seconds) {
            document.querySelectorAll('.timer-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector(`[data-timer="${seconds}"]`).classList.add('active');
        }

        function saveSettings() {
            const activeOption = document.querySelector('.timer-option.active');
            autoHideSeconds = parseInt(activeOption.dataset.timer);
            
            localStorage.setItem(TIMER_KEY, autoHideSeconds.toString());
            closeSettings();
            
            const timerText = autoHideSeconds === 0 ? 'never' : `${autoHideSeconds}s`;
            showNotification(`⚙️ Auto-hide timer set to ${timerText}`, 'success');
            
            if (balanceVisible) {
                clearAutoHideTimer();
                startAutoHideTimer();
            }
        }

        // Demo data for showcasing features (Malaysian Ringgit amounts)
        const demoTransactions = [
            {
                id: 1001,
                type: 'income',
                amount: 4500,
                description: 'Monthly Salary',
                category: 'Salary',
                payment: 'Bank Transfer',
                isPayment: false,
                date: new Date().toLocaleDateString(),
                time: '09:00'
            },
            {
                id: 1002,
                type: 'expense',
                amount: 1200,
                description: 'Rent Payment',
                category: 'Bills & Utilities',
                payment: 'Bank Transfer',
                isPayment: true,
                date: new Date().toLocaleDateString(),
                time: '10:30'
            },
            {
                id: 1003,
                type: 'expense',
                amount: 65.80,
                description: 'Grocery Shopping at 99 Speedmart',
                category: 'Food & Dining',
                payment: 'Touch \'n Go eWallet',
                isPayment: false,
                date: new Date().toLocaleDateString(),
                time: '14:15'
            },
            {
                id: 1004,
                type: 'expense',
                amount: 45.50,
                description: 'Petrol at Petronas',
                category: 'Transportation',
                payment: 'Debit Card',
                isPayment: false,
                date: new Date().toLocaleDateString(),
                time: '16:22'
            },
            {
                id: 1005,
                type: 'income',
                amount: 320,
                description: 'Freelance Web Design',
                category: 'Business',
                payment: 'Grab Pay',
                isPayment: false,
                date: new Date().toLocaleDateString(),
                time: '18:45'
            },
            {
                id: 1006,
                type: 'expense',
                amount: 15.90,
                description: 'Netflix Subscription',
                category: 'Entertainment',
                payment: 'Credit Card',
                isPayment: true,
                date: new Date().toLocaleDateString(),
                time: '20:00'
            },
            {
                id: 1007,
                type: 'expense',
                amount: 28.60,
                description: 'Grab Food - Nasi Lemak',
                category: 'Food & Dining',
                payment: 'Grab Pay',
                isPayment: false,
                date: new Date().toLocaleDateString(),
                time: '12:30'
            },
            {
                id: 1008,
                type: 'income',
                amount: 1500,
                description: 'Bonus Payment',
                category: 'Salary',
                payment: 'Bank Transfer',
                isPayment: false,
                date: new Date().toLocaleDateString(),
                time: '15:30'
            }
        ];

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Local Storage functions - now user-specific
        function saveTransactions() {
            if (!currentUser) return;
            
            try {
                const key = `${STORAGE_KEY}_${currentUser.id}`;
                localStorage.setItem(key, JSON.stringify(transactions));
            } catch (e) {
                showNotification('Error saving data locally', 'error');
                console.error('Error saving to localStorage:', e);
            }
        }

        function loadTransactions() {
            if (!currentUser) return;
            
            try {
                const key = `${STORAGE_KEY}_${currentUser.id}`;
                const saved = localStorage.getItem(key);
                if (saved) {
                    transactions = JSON.parse(saved);
                } else {
                    transactions = [];
                }
            } catch (e) {
                showNotification('Error loading saved data', 'error');
                console.error('Error loading from localStorage:', e);
                transactions = [];
            }
        }

        // All other functions remain the same (loadDemoData, showTab, etc.)
        function loadDemoData() {
            transactions = [...demoTransactions];
            saveTransactions();
            updateDisplays();
            showNotification('🎯 Demo data loaded successfully!', 'success');
        }

        function clearAllData() {
            if (confirm('Clear all saved data? This cannot be undone.')) {
                transactions = [];
                saveTransactions();
                updateDisplays();
                showNotification('🗑️ All data cleared successfully', 'warning');
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('[id$="-tab"]').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            updateDisplays();
            document.querySelector('.main-content').scrollTop = 0;
        }

        function openAddForm(type) {
            currentType = type;
            isPaymentMode = false;
            isEditMode = false;
            editingTransactionId = null;
            
            document.getElementById('modal-title').textContent = `Add ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('type-toggle').style.display = 'flex';
            
            setType(type);
            clearForm();
            document.getElementById('add-modal').classList.remove('hidden');
        }

        function openPaymentForm() {
            currentType = 'expense';
            isPaymentMode = true;
            isEditMode = false;
            editingTransactionId = null;
            
            document.getElementById('modal-title').textContent = 'Record Payment';
            document.getElementById('type-toggle').style.display = 'none';
            document.getElementById('submit-btn').className = 'btn btn-primary';
            document.getElementById('submit-btn').textContent = 'Record Payment';
            
            clearForm();
            document.getElementById('category-input').value = 'Bills & Utilities';
            document.getElementById('payment-input').value = 'Bank Transfer';
            document.getElementById('add-modal').classList.remove('hidden');
        }

        function openEditForm(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;

            currentType = transaction.type;
            isPaymentMode = transaction.isPayment;
            isEditMode = true;
            editingTransactionId = transactionId;

            document.getElementById('modal-title').textContent = 'Edit Transaction';
            document.getElementById('type-toggle').style.display = isPaymentMode ? 'none' : 'flex';

            document.getElementById('amount-input').value = transaction.amount;
            document.getElementById('description-input').value = transaction.description;
            document.getElementById('category-input').value = transaction.category;
            document.getElementById('payment-input').value = transaction.payment;

            if (!isPaymentMode) {
                setType(transaction.type);
            } else {
                document.getElementById('submit-btn').className = 'btn btn-primary';
                document.getElementById('submit-btn').textContent = 'Update Payment';
            }

            if (!isPaymentMode) {
                document.getElementById('submit-btn').className = transaction.type === 'income' ? 'btn btn-success' : 'btn btn-danger';
                document.getElementById('submit-btn').textContent = `Update ${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}`;
            }

            document.getElementById('add-modal').classList.remove('hidden');
        }

        function setType(type) {
            currentType = type;
            const expenseBtn = document.getElementById('expense-btn');
            const incomeBtn = document.getElementById('income-btn');
            const submitBtn = document.getElementById('submit-btn');
            
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            
            if (type === 'expense') {
                expenseBtn.classList.add('active');
                
                if (isEditMode) {
                    submitBtn.className = 'btn btn-danger';
                    submitBtn.textContent = 'Update Expense';
                } else {
                    submitBtn.className = 'btn btn-danger';
                    submitBtn.textContent = 'Add Expense';
                }
            } else {
                incomeBtn.classList.add('active');
                
                if (isEditMode) {
                    submitBtn.className = 'btn btn-success';
                    submitBtn.textContent = 'Update Income';
                } else {
                    submitBtn.className = 'btn btn-success';
                    submitBtn.textContent = 'Add Income';
                }
            }
        }

        function clearForm() {
            document.getElementById('amount-input').value = '';
            document.getElementById('description-input').value = '';
            document.getElementById('category-input').value = '';
            document.getElementById('payment-input').value = '';
        }

        function closeModal() {
            document.getElementById('add-modal').classList.add('hidden');
            clearForm();
            isPaymentMode = false;
            isEditMode = false;
            editingTransactionId = null;
        }

        function addTransaction() {
            const amount = parseAmount(document.getElementById('amount-input').value);
            const description = document.getElementById('description-input').value.trim();
            const category = document.getElementById('category-input').value;
            const payment = document.getElementById('payment-input').value;

            if (!description) {
                showNotification('Please enter a description', 'error');
                return;
            }
            if (!amount || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            if (!category) {
                showNotification('Please select a category', 'error');
                return;
            }
            if (!payment) {
                showNotification('Please select a payment method', 'error');
                return;
            }

            if (isEditMode && editingTransactionId) {
                const transactionIndex = transactions.findIndex(t => t.id === editingTransactionId);
                if (transactionIndex !== -1) {
                    transactions[transactionIndex] = {
                        ...transactions[transactionIndex],
                        type: currentType,
                        amount: amount,
                        description: description,
                        category: category,
                        payment: payment,
                        lastModified: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    };
                    
                    saveTransactions();
                    showNotification('✅ Transaction updated successfully!', 'success');
                }
            } else {
                const transaction = {
                    id: Date.now(),
                    type: currentType,
                    amount: amount,
                    description: description,
                    category: category,
                    payment: payment,
                    isPayment: isPaymentMode,
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                };

                transactions.unshift(transaction);
                saveTransactions();
                showNotification('✅ Transaction added successfully!', 'success');
            }

            updateDisplays();
            closeModal();
        }

        function deleteTransaction(id) {
            if (confirm('Delete this transaction? This cannot be undone.')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateDisplays();
                showNotification('🗑️ Transaction deleted successfully', 'warning');
            }
        }

        function updateDisplays() {
            updateBalanceCard();
            updateRecentTransactions();
            updateAllTransactions();
            updateAnalytics();
            updateHealthIndicator();
        }

        function updateBalanceCard() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;

            document.getElementById('balance-display').textContent = formatCurrencyWithPrivacy(balance);
            document.getElementById('income-display').textContent = formatCurrencyWithPrivacy(income);
            document.getElementById('expenses-display').textContent = formatCurrencyWithPrivacy(expenses);

            const balanceEl = document.getElementById('balance-display');
            const incomeEl = document.getElementById('income-display');
            const expensesEl = document.getElementById('expenses-display');
            
            if (balanceVisible) {
                balanceEl.classList.remove('hidden-amount');
                incomeEl.classList.remove('hidden-amount');
                expensesEl.classList.remove('hidden-amount');
            } else {
                balanceEl.classList.add('hidden-amount');
                incomeEl.classList.add('hidden-amount');
                expensesEl.classList.add('hidden-amount');
            }

            let message;
            if (transactions.length === 0) {
                message = balanceVisible ? "Start tracking or load demo data!" : "Tap the eye to view your balance";
            } else {
                if (balanceVisible) {
                    message = balance >= 0 ? "Great financial progress!" : "Review your spending";
                } else {
                    message = "Tap the eye to view your balance";
                }
            }
            document.getElementById('balance-message').textContent = message;
        }

        function updateHealthIndicator() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            const ratioElement = document.getElementById('expense-ratio');
            const progressElement = document.getElementById('expense-progress');
            
            if (income > 0) {
                const ratio = (expenses / income) * 100;
                ratioElement.textContent = `${ratio.toFixed(1)}%`;
                progressElement.style.width = `${Math.min(ratio, 100)}%`;
            } else {
                ratioElement.textContent = 'N/A';
                progressElement.style.width = '0%';
            }
        }

        function updateRecentTransactions() {
            const container = document.getElementById('recent-transactions');
            const recent = transactions.slice(0, 5);

            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                        <h4 class="empty-title">Welcome to Malaysian Planning!</h4>
                        <p class="empty-subtitle">Secure financial tracking with Face ID protection</p>
                        <div style="display: flex; gap: 12px; justify-content: center;">
                            <button class="btn btn-primary" onclick="openAddForm('expense')">Add Transaction</button>
                            <button class="btn btn-secondary" onclick="loadDemoData()">Demo Data</button>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = recent.map(transaction => {
                    const amountDisplay = balanceVisible 
                        ? `${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount).replace('RM ', '')}`
                        : `${transaction.type === 'income' ? '+' : '-'}••••••`;
                    
                    return `
                        <div class="transaction-item">
                            <div class="transaction-icon ${transaction.type}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    ${transaction.type === 'income' ? 
                                        '<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>' : 
                                        '<line x1="5" y1="12" x2="19" y2="12"/>'}
                                </svg>
                            </div>
                            <div class="transaction-details">
                                <p class="transaction-title">${transaction.description}</p>
                                <p class="transaction-meta">${transaction.category} • ${transaction.payment}</p>
                            </div>
                            <div class="transaction-amount">
                                <p class="amount-value ${transaction.type} ${!balanceVisible ? 'hidden-amount' : ''}">
                                    ${amountDisplay}
                                </p>
                                <p class="amount-time">${transaction.time}</p>
                            </div>
                            <div class="transaction-actions">
                                <button class="action-btn edit" onclick="openEditForm(${transaction.id})" title="Edit">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="action-btn delete" onclick="deleteTransaction(${transaction.id})" title="Delete">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function updateAllTransactions() {
            const container = document.getElementById('all-transactions');
            const countElement = document.getElementById('transaction-count');
            
            countElement.textContent = `${transactions.length} entries`;

            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"/>
                                <line x1="8" y1="12" x2="21" y2="12"/>
                                <line x1="8" y1="18" x2="21" y2="18"/>
                                <line x1="3" y1="6" x2="3.01" y2="6"/>
                                <line x1="3" y1="12" x2="3.01" y2="12"/>
                                <line x1="3" y1="18" x2="3.01" y2="18"/>
                            </svg>
                        </div>
                        <h4 class="empty-title">No transactions saved yet</h4>
                        <p class="empty-subtitle">Add transactions or load demo data to see them here</p>
                        <button class="btn btn-primary" onclick="loadDemoData()">Load Demo Data</button>
                    </div>
                `;
            } else {
                container.innerHTML = transactions.map(transaction => {
                    const amountDisplay = balanceVisible 
                        ? `${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount).replace('RM ', '')}`
                        : `${transaction.type === 'income' ? '+' : '-'}••••••`;
                    
                    return `
                        <div class="transaction-item">
                            <div class="transaction-icon ${transaction.type}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    ${transaction.type === 'income' ? 
                                        '<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>' : 
                                        '<line x1="5" y1="12" x2="19" y2="12"/>'}
                                </svg>
                            </div>
                            <div class="transaction-details">
                                <p class="transaction-title">${transaction.description}</p>
                                <p class="transaction-meta">${transaction.category} • ${transaction.payment} • ${transaction.date}${transaction.lastModified ? ` • Modified ${transaction.lastModified}` : ''}${transaction.isPayment ? ' • Payment' : ''}</p>
                            </div>
                            <div class="transaction-amount">
                                <p class="amount-value ${transaction.type} ${!balanceVisible ? 'hidden-amount' : ''}">
                                    ${amountDisplay}
                                </p>
                            </div>
                            <div class="transaction-actions">
                                <button class="action-btn edit" onclick="openEditForm(${transaction.id})" title="Edit">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                                <button class="action-btn delete" onclick="deleteTransaction(${transaction.id})" title="Delete">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function updateAnalytics() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;
            const incomeCount = transactions.filter(t => t.type === 'income').length;
            const expenseCount = transactions.filter(t => t.type === 'expense').length;

            const analyticsElements = {
                income: document.getElementById('analytics-income'),
                expenses: document.getElementById('analytics-expenses'),
                balance: document.getElementById('analytics-balance')
            };

            analyticsElements.income.textContent = formatCurrencyWithPrivacy(income);
            analyticsElements.expenses.textContent = formatCurrencyWithPrivacy(expenses);
            analyticsElements.balance.textContent = formatCurrencyWithPrivacy(balance);
            
            Object.values(analyticsElements).forEach(el => {
                if (balanceVisible) {
                    el.classList.remove('hidden-amount');
                } else {
                    el.classList.add('hidden-amount');
                    el.style.color = '#9ca3af !important';
                }
            });

            document.getElementById('income-count').textContent = incomeCount;
            document.getElementById('expense-count').textContent = expenseCount;

            const scoreElement = document.getElementById('health-score');
            const messageElement = document.getElementById('health-message');
            
            if (income > 0) {
                let score, message, color;
                if (balance > income * 0.2) {
                    score = 'A+';
                    message = "Excellent! Great saving ratio.";
                    color = '#10b981';
                } else if (balance > 0) {
                    score = 'B';
                    message = 'Good! Consider saving more.';
                    color = '#f59e0b';
                } else {
                    score = 'C';
                    message = 'Review your spending habits.';
                    color = '#ef4444';
                }
                scoreElement.textContent = score;
                scoreElement.style.color = color;
                messageElement.textContent = message;
            } else {
                scoreElement.textContent = '-';
                scoreElement.style.color = '#6b7280';
                messageElement.textContent = 'Add income to calculate health score';
            }

            updateCategoryAnalytics();
        }

        function updateCategoryAnalytics() {
            const categories = {};
            const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            transactions.filter(t => t.type === 'expense').forEach(t => {
                categories[t.category] = (categories[t.category] || 0) + t.amount;
            });

            const categoryList = Object.entries(categories)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const categoryAnalytics = document.getElementById('category-analytics');
            const categoryListElement = document.getElementById('category-list');

            if (categoryList.length > 0) {
                categoryAnalytics.classList.remove('hidden');
                categoryListElement.innerHTML = categoryList.map(([category, amount], index) => {
                    const percentage = totalExpenses > 0 ? (amount / totalExpenses) * 100 : 0;
                    const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'];
                    const displayAmount = balanceVisible ? formatCurrency(amount) : '••••••';
                    
                    return `
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 14px; font-weight: 600; color: #1f2937;">${category}</span>
                                <span style="font-size: 14px; color: ${colors[index]}; font-weight: 600;">${displayAmount}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%; background-color: ${colors[index]};"></div>
                            </div>
                            <div style="text-align: right; margin-top: 4px;">
                                <span style="font-size: 12px; color: #6b7280;">${percentage.toFixed(1)}%</span>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                categoryAnalytics.classList.add('hidden');
            }
        }

        // Initialize app with authentication and localStorage loading
        document.addEventListener('DOMContentLoaded', function() {
            // Load privacy preference first (always starts hidden)
            loadPrivacyPreference();
            
            // Check login status
            const hasUser = checkLoginStatus();
            
            if (hasUser) {
                // User is logged in, hide login screen and load app
                document.getElementById('login-screen').classList.add('hidden');
                loadTransactions();
                updateDisplays();
                
                // Update header with user info
                document.getElementById('header-username').textContent = currentUser.name.split(' ')[0];
                
                // Show privacy splash for first-time users
                setTimeout(() => {
                    if (firstVisit) {
                        showPrivacySplash();
                    } else {
                        showNotification('👋 Welcome back! Tap eye to show amounts.', 'success');
                    }
                }, 1000);
            } else {
                // No user logged in, show login screen
                document.getElementById('login-screen').classList.remove('hidden');
            }
            
            // Update time every minute
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);
            
            console.log('🇲🇾 Malaysian Financial Planning with Face Recognition Loaded');
            console.log('💾 User-specific data persistence with localStorage');
            console.log('💰 Malaysian Ringgit (RM) currency with comma formatting');
            console.log('🔒 Privacy mode with auto-hide timer');
            console.log('👤 Face Recognition + PIN authentication');
            console.log('📱 Full mobile app experience');
        });

        // Close modals when clicking outside
        document.getElementById('privacy-splash').addEventListener('click', function(e) {
            if (e.target === this) {
                hidePrivacySplash();
            }
        });

        document.getElementById('settings-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettings();
            }
        });

        document.getElementById('add-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('face-recognition-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFaceRecognition();
            }
        });

        document.getElementById('pin-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePinLogin();
            }
        });

        document.getElementById('registration-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeRegistration();
            }
        });

        // Cleanup camera streams when page unloads
        window.addEventListener('beforeunload', function() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
